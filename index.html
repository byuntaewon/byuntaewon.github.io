<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js USDZ 뷰어</title>
    <style>
        /* HTML과 Body가 캔버스를 꽉 채우도록 설정 */
        body { margin: 0; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        // 3. 필요한 모듈들을 import 합니다.
        import * as THREE from 'three';
        
        // (수정) GLTFLoader가 아닌 USDLoader를 import 합니다.
        import { USDLoader } from 'three/addons/loaders/USDLoader.js'; 
        
        // (선택) 마우스로 모델을 돌려볼 수 있게 하는 컨트롤러
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 4. 기본 3요소: Scene(장면), Camera(카메라), Renderer(렌더러) 설정
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xeeeeee); // 배경색 설정

        const camera = new THREE.PerspectiveCamera(
            75, // 시야각 (Field of View)
            window.innerWidth / window.innerHeight, // 종횡비 (Aspect Ratio)
            0.1, // Near (너무 가까우면 안 보임)
            1000 // Far (너무 멀면 안 보임)
        );
        camera.position.z = 5; // 카메라를 Z축으로 5만큼 뒤로 이동

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement); // 캔버스를 HTML에 추가

        // 5. (선택) OrbitControls 설정 (마우스 인터랙션)
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; // 부드러운 움직임
        controls.update();

        // 6. (필수) 조명 설정 (조명이 없으면 모델이 검게 보입니다)
        const ambientLight = new THREE.AmbientLight(0xffffff, 1); // 은은한 주변광
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 2); // 태양광 같은 직사광
        directionalLight.position.set(5, 10, 7.5);
        scene.add(directionalLight);

        // 7. (핵심) USDLoader 로더 생성 및 모델 로드
        
        // (수정) GLTFLoader 대신 USDLoader를 생성합니다.
        const loader = new USDLoader(); 
        
        loader.load(
            // 이 파일 경로는 올바릅니다.
            'https://byuntaewon.github.io/backpack.usdz', 
            
            // 로드 완료 시 실행되는 함수
            // (수정) USDLoader는 'model' 객체를 바로 반환합니다. (gltf.scene이 아님)
            function ( model ) {
                // (수정) model 객체를 장면에 바로 추가합니다.
                scene.add( model ); 
                console.log("USDZ 모델 로드 성공!");
            },
            
            // (선택) 로드 진행 중 실행되는 함수
            function (xhr) {
                console.log((xhr.loaded / xhr.total * 100) + '% loaded');
            },
            
            // (선택) 로드 실패 시 실행되는 함수
            function (error) {
                console.error('USDZ 모델 로드 중 에러 발생', error);
            }
        );

        // 8. (필수) 애니메이션 루프: 매 프레임마다 렌더링
        function animate() {
            requestAnimationFrame(animate); // 다음 프레임 요청

            controls.update(); // 컨트롤이 있다면 업데이트
            renderer.render(scene, camera); // 장면을 카메라 시점으로 렌더링
        }

        // 애니메이션 시작!
        animate();

        // (선택) 창 크기가 변경될 때 캔버스 크기도 조절
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
