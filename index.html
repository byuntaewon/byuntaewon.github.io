<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js USDZ 뷰어</title>
    <style>
        /* HTML과 Body가 캔버스를 꽉 채우도록 설정 */
        body { margin: 0; }
        canvas { display: block; }
    </style>
</head>
<body>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.164.1/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.164.1/examples/jsm/"
        }
    }
    </script>

    <script type="module">
        // 3. 필요한 모듈들을 import 합니다.
        // 'three'라는 이름은 importmap에 의해 URL로 치환됩니다.
        import * as THREE from 'three';
        
        // (수정) USDZLoader.js 로 변경
        import { USDZLoader } from 'three/addons/loaders/USDZLoader.js'; 
        
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // 4. 기본 3요소: Scene(장면), Camera(카메라), Renderer(렌더러) 설정
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0xeeeeee); 

        const camera = new THREE.PerspectiveCamera(
            75, 
            window.innerWidth / window.innerHeight, 
            0.1, 
            1000 
        );
        camera.position.z = 5; 

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement); 

        // 5. (선택) OrbitControls 설정 (마우스 인터랙션)
        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true; 
        controls.update();

        // 6. (필수) 조명 설정
        const ambientLight = new THREE.AmbientLight(0xffffff, 1); 
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 2); 
        directionalLight.position.set(5, 10, 7.5);
        scene.add(directionalLight);

        // 7. (핵심) USDZLoader 로더 생성 및 모델 로드
        
        // (수정) new USDZLoader() 로 변경
        const loader = new USDZLoader(); 
        
        loader.load(
            'https://byuntaewon.github.io/backpack.usdz', 
            
            function ( model ) {
                scene.add( model ); 
                console.log("USDZ 모델 로드 성공!");
            },
            
            function (xhr) {
                console.log((xhr.loaded / xhr.total * 100) + '% loaded');
            },
            
            function (error) {
                console.error('USDZ 모델 로드 중 에러 발생', error);
            }
        );

        // 8. (필수) 애니메이션 루프
        function animate() {
            requestAnimationFrame(animate); 
            controls.update(); 
            renderer.render(scene, camera); 
        }

        animate();

        // (선택) 창 크기 조절
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
